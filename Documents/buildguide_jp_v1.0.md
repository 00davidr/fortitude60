# Fortitude60 v1.0（C94 Limited Edition) ビルドガイド
## 部品

### キットに付属しているもの
以下の部品表は両手分の数量です。片手だけ作りたいという物好きな方は数量を半分にしてください。

|部品名|型番|数量|メモ|
|------|----|----|----|
|PCB|fortitude60 main|2枚|キット付属|
|プレート|fortitude60 plate|2枚|キット付属|
|MCU|beetle USB 32u4|2個|キット付属、デフォルトファーム書き込み済み|
|USB Type-C|AE-USB2.0-TYPE-C|2個|キット付属|
|ダイオード|1N4148 100V200mA|60個|リードタイプが付属、SMDでも可|
|タクトスイッチ|2.54mmピッチ|2個|キット付属|
|TRRSジャック|MJ-4PP-9|2個|キット付属|
|ゴム足|大2個小2個|4個|キット付属|
|TRRSケーブル|4極ケーブル|1本|キット付属、30cm|

### 各自用意する必要があるもの
以下の部品表は動作に必要ですがキットに付属しないため各自用意してください。

|部品名|型番|数量|メモ|
|------|----|----|----|
|キースイッチ|Cherry MX系|60個|PCBマウント対応|
|キーキャップ|Cherry MX系|60個|PCBマウント対応|
|USBケーブル|Type-C対応|1個|Type-C to Type-Cケーブル仕様時は別途抵抗が必要となります。|

[^underglow]: Underglow機能など。Backlight機能とUnderglow機能はMCUの仕様上排他となります。

### 必要に応じて用意するもの

以下の部品表はオプションです。必ずしも動作に必要ではありません。

|部品名|型番|数量|メモ|
|------|----|----|----|
|LED|3mm砲弾型(Vf=1.4V, 8mA)|60個|Backlight機能|
|抵抗|470ohm, リードまたは3216|60個|Backlight機能|
|抵抗|1kohm, リードまたは3216|2個|Backlight機能|
|抵抗|5.1kohm, リード|2個|USB Type-C to Type-Cケーブル仕様時|
|FET|IRLML6344TRPbF(Nch MOSFET)|2個|Backlight機能|
|------|----|----|----|
|テープLED|WS2812B(フルカラーLED)|2本|Underglow機能|
|配線材|柔らかめのもの|適量|Underglow機能|

## 必要な工具

|部品名|メモ|
|------|----|
|はんだごて|セラミックヒータータイプが使いやすいです。HAKKO FX-600がおすすめ|
|はんだ|千住金属工業のスパークルハンダが個人的におすすめです|
|ニッパー|刃を閉じて光にかざしたときに隙間がないのを選びましょう|
|ピンセット|HOZAN P-891が肉厚で使いやすいです。|
|テスター|導通チェッカー機能とダイオード確認機能がついていると便利|
|マスキングテープ|仮止め用|
|折れない心|やけどなど怪我には気をつけましょう👊|


## 組み立て

![基板](https://i.imgur.com/zFJ0plE.jpg)

基板を写真のように並べ左手側と右手側を決めます。以降の説明ではキースイッチを取り付ける面をスイッチ面、ダイオードを取り付ける面を部品面とします。

### (細かい部品の実装箇所)
![Imgur](https://i.imgur.com/p3cmwDP.jpg)
オプションのLEDを含んだ図。反対側も同じです。

### ダイオードの取り付け

![ダイオード（リード）](https://i.imgur.com/fr5uVkG.jpg)  
![ダイオード（SMD）](https://i.imgur.com/vgTHEJx.jpg)

ダイオードは部品面（赤色実装箇所）に取り付けます、リードタイプはスイッチ面からはんだ付け、SMDは部品面からはんだ付けしてください。
ダイオードは部品に方向があり、基板上のマークの矢印方向にマークを合わせて実装します。
一部シルクにマークが潰れていますがすべて同じ方向になります。
（写真のように基板を置いたのであれば全部下向きにマークを揃えてください。）

テスターのダイオードモードでチェックし、はんだ付けができていることを確認します。

### Backlight用LED用部品の取り付け（オプション）

![Backlight部品](https://i.imgur.com/Do3gXGw.jpg)

バックライトLEDの抵抗を部品面に取り付けます。リードタイプはスイッチ面からはんだ付け、SMDは部品面からはんだ付けしてください。
部品に極性はありません。1箇所のみ抵抗値が異なるので気を付けてください。

はんだ付け後にはテスターで抵抗値を確認しましょう。

LEDを駆動するためのFETを部品面に取り付けます。表面実装部品のため実装難易度が高いですが、1箇所予備ハンダをして先に固定してしまえば楽になります。

### TRRSジャック、タクトスイッチの取り付け

![TRRS&SW](https://i.imgur.com/o5jTdhK.jpg)

TRRSジャックとタクトスイッチは部品面のシルクに合わせて取り付け、スイッチ面からはんだ付けします。

PCB v1.0ではフットプリントの不備により、ピンを1本ずらして実装する必要があります。曲げたピンからはんだ付けして固定されることを確認してください。
PCB v1.1ではこの問題は解決されているため、ピンを曲げずに実装してください。
PCBのバージョンは左手側の場合スイッチ面、右手側の場合は部品面の左下に記載されています。

![TRRS折り曲げ](https://i.imgur.com/R4nxaFw.jpg)
![はんだ付け箇所](https://i.imgur.com/hTOVGtO.jpg)

TRRSケーブルを接続し、それぞれの対称のピンが導通していることを導通チェッカーで確認します。

### ピンヘッダの取り付け

![MCUピンヘッダ](https://i.imgur.com/oPl7QHQ.jpg)
![MCUピンヘッダはんだ付け](https://i.imgur.com/c0q57L4.jpg)
![USBピンヘッダ](https://i.imgur.com/N8x93Hu.jpg)

MCU（コントローラー）とUSBコネクタを取り付けるピンヘッダを取り付けます。ピン数に合わせてピンヘッダを切断し、部品面に取り付けスイッチ面からはんだ付けします。片手のPCBにはMCUへは6ピンを3つ、USBコネクタには2ピンを2つずつはんだ付けします。

```[注意]まだこの時点ではMCUをはんだ付けしません！！！```

### キースイッチの取り付け

![キースイッチの取り付け](https://i.imgur.com/TzgloSK.jpg)

キースイッチを取り付けます。プレートにキースイッチをはめ込みながらスイッチ面に取り付けます。部品面の穴からすべての足が折り曲がらずに見えていることを確認してください。
スイッチを取り付ける際に写真のようにケースの一部分を軽くはめるとはんだ付けしやすいです（完全にはめたりすべてのケースを組んでしまうと分解が大変です）。
確認が終わったら部品面からはんだ付けします。

（オプション）Backlight用LEDを取り付ける場合には、スルーホールが丸い穴がアノード（＋）で四角い方がカソード（-）になります。

### MCUの準備

![MCUの区別](https://i.imgur.com/rGWsc2V.jpg)

MCUはテスト用のファームウェアが書き込み済みであり、写真のようにシールが貼られている方が左手側のMCUとなります。

### USB-Type Cで使用する場合
MacBookなど最近のノートPCではType-Cコネクタのみのものが増えています。そんなPCでFortitude60を使いたい場合には、USB Type-Cコネクタ側にデバイスであることをPCに通知するためにCC1とCC2ピンを5.1kΩ抵抗でプルダウンしてください。

### USBコネクタとMCUの接続
![リード線の加工](https://i.imgur.com/TmkKmtx.jpg)  
![USBtoMCU](https://i.imgur.com/1KG1w1b.jpg)

USBコネクタとMCUをはんだ付けします。配線材を5~6cmほどの長さに4本切り出し、両端の被覆を2mm程度剥き予備ハンダをします。その後にUSBコネクタとMCUを写真のようにはんだ付けします。ピンを間違えると接続したPCを破壊する可能性があるので気をつけてください。もう片方のMCUにも同様に処理をします。

念の為テスターでUSBコネクタのGNDとMCUのGNDを導通チェックします。

![PwerLED](https://i.imgur.com/vUIUgq7.jpg)

（オプション）MCUにはPのシルクで電源LEDが実装されており、これが割と明るいため別にLEDを実装した場合は色が混ざったりするため必要な人はLEDを取り外すことをおすすめします。

### USBコネクタとMCUの取り付け

![MCUonPCB](https://i.imgur.com/456zKTy.jpg)

USBコネクタを部品面にはんだ付けします。USBコネクタに取り付け方向はありません。

![Imgur](https://i.imgur.com/G5kPgvn.jpg)

MCUはシールが貼ってあるものが左手側となり、基板上のシルクの表記（3V3など）とMCUのシルクを合わせた向きで組み込みます。フットプリントをきつめに設計しているためはんだ付けしなくても動作は可能ですが、ゆるい場合や一部接触不良になる場合ははんだ付けしてください。

組み込まれるとキーボードをひっくり返した時に"左手側"のシールのみが見えるのが正しい向きです。間違えるとショートするので気をつけてください。

### Underglow用LEDテープの取り付け（オプション）

![LEDテープ配線（左手側）](https://i.imgur.com/1mjnhY7.png)

![LEDテープ配線（左手側）](https://i.imgur.com/pAOH0FI.png)

Underglowを追加する場合は、”左手側の”基板上にある「LED」の部分を基準に写真のように配線していきます。

Underglowを使用する場合は左右で「EXTRA DATA」を通じて通信するため、必ず4極あるTRRSケーブルを使用してください。


### ケースの組み立て

![ケース組み立て図](https://i.imgur.com/tCJ72Rt.png)

アクリルケースは箱組の強度を上げるため寸法をきつく設計しています。アクリルの保護シートを剥がし画像のように組み立ててください。平坦な長辺がキーボードの上側で、凹凸がある長辺が下に来ます。片手の中に同じ形をした部品は無いため間違った場所には嵌らないようになっています。少しでも違和感を覚えたら力任せに嵌めずに場所を確認し、必要に応じてヤスリで調整するなどしてください。特に隣の辺と組み合わさる部分は割れやすいので気をつけてください。（特にAとBが組み込みづらい上に割れやすいので一番先に組むのがおすすめです。）

![組み立て例](https://i.imgur.com/5FMGbSL.jpg)

![ゴム足](https://i.imgur.com/mKuVylI.png)

最後に底蓋を嵌めこみます。底蓋にはゴム足を写真のように取り付けると少し傾斜ができます。逆に分解する場合にはUSBコネクタ部分の隙間に棒などを差し込んでてこの原理で外すとやりやすいです。

### 完成

## QMKファームウェアの書き込み

購入時点でテスト用ファームウェアが書き込まれているため、そのまま入力は可能です。キーマップのカスタマイズやオプション機能を使う場合は以下の手順で書き込んでください。
QMKのファームウェアのFORTITUDE60のキーボードは以下にあります。
[https://github.com/qmk/qmk_firmware/tree/master/keyboards/fortitude60](https://github.com/qmk/qmk_firmware/tree/master/keyboards/fortitude60)

QMKのビルド環境の構築などは公式ドキュメント[docs.qmk.fm](https://docs.qmk.fm/)を参照するかググってください。

### キーマップのカスタマイズ

```/keymaps/default/```を参考に```keymap.c```を編集します。

### Backlight機能の有効化

```/keymaps/[your keymap]/rules.mk```に```BACKLIGHT_ENABLE = yes```を追加します。

Underglow機能と両立はできません。

### Underglow機能の有効化

テスト用ファームで有効になっています。

```/keymaps/[your keymap]/rules.mk```の```RGBLIGHT_ENABLE = yes```を追加します。

Backlight機能と両立はできません。また必ず取り付けたLEDテープの数を``/keymaps/config.h``の`RGBLED_NUM`に記述します。

# テスト用ファームのキーマップ

## 通常レイヤー
![Default](https://i.imgur.com/LwIhpyb.png)

キーの赤色と青色で示された部分は「LOWER」と「RAISE」それぞれとの同時押しで実現するレイヤーになります。

## Adjustレイヤー（LOWER+RAISE)
![Adjust](https://i.imgur.com/SxD5wZX.png)

「LOWER」と「RAISE」を同時押しするとキーボードの設定を変えられるAdjustmentレイヤーになります（押している間のみ）。上から2段めの「RGB Toggle」より右側はUnderglowの制御用キーです。上から3段目の「BL Toggle」及び「BL Step」はそれぞれBacklightのオン/オフと輝度を変えることができます。
